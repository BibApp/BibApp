- if !group_list_item.hide?
  - # only show groups that are in the @groups list
  - if @groups.include?(group_list_item) 
    %li.parent.list-style-none
      %div.membership-group{:id => "group_id-#{group_list_item.id}"}
        - if group_list_item.children.empty?
          &nbsp;&nbsp;
        - else
          - if @query.blank?
            = link_to "+", "javascript:void(0)", {:onclick => "toggle_folder(#{group_list_item.id});", :id => "toggle_switch_#{group_list_item.id}"}
          - else
            = link_to "&ndash;", "javascript:void(0)", {:onclick => "toggle_folder(#{group_list_item.id});", :id => "toggle_switch_#{group_list_item.id}"}
        - parent_id = group_list_item.parent.nil? ? nil : group_list_item.parent.id
        - if @person.groups.include?(group_list_item)
          = check_box_tag "group_id[].ignore", "#{group_list_item.id}", true, {:disabled => true}
        - else
          = check_box_tag "group_id[]", "#{group_list_item.id}", false, {:onclick => "if (this.checked == true) check_parent(#{parent_id});"}
        = group_list_item.name

      - unless group_list_item.children.empty?
        - if @query.blank?
          %ul#children_of.children.list-style-none{:id => group_list_item.id, :style => "display: none;"}
            = render :partial => 'group_list_item', :collection => group_list_item.children
        - else
          %ul#children_of.children.list-style-none{:id => group_list_item.id}
            = render :partial => 'group_list_item', :collection => group_list_item.children