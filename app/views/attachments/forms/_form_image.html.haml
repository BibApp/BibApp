-#
-# Render Form for Creating/Editing an Image
-#

-# Determine Form URL and Method based on whether we are editing or creating an image
- form_url = attachments_url
- form_method = :post
- if !@attachment.new_record?
  - form_url = attachment_path(@attachment)
  - form_method = :put
  -# Also, set the asset, if unset
  - @asset ||= @attachment.asset

-# Actually build the form
= form_for :attachment, :url => form_url, :html => { :method => form_method, :multipart => true } do |form|
  -# If there is an existing image, display it
  -if !@attachment.new_record?

    .span-4.prepend-1
      #picture.span-3
        %p= render "shared/person_image", :o => @asset

      -if @person.image
        = link_to "delete image", attachment_url(:id => @asset.image.id), :method => :delete

  %fieldset
    %legend New Image
    %label Upload File:
    %br/
    = render 'upload_file', :form => form

    -# save asset id as person_id
    = hidden_field_tag :person_id, @asset.id

    -# Save type of attachment
    = hidden_field_tag :type, @attachment.class

    %p.submit
      = submit_tag "Upload image", :disable_with => "Uploading your image..."
      = link_to "Cancel", get_response_url(@asset)