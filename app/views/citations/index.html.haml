/ === Citations === Index ===
/ Main
%div{:class => "span-24"}
  %div{:class => "span-22 prepend-1"}
    - if flash[:notice]
      %div.success= flash[:notice]

    - if logged_in? && current_user.has_role?("editor")
      %ul#edit-actions
        %li=link_to "Add a Citation", new_citation_path
          
  / If they want to see *everything*, let them see it!
  / params[:view] = "all"
  - if @view == "all" && @export.empty?
    %div{:class => "span-22 prepend-1"}
      
      %h2="Citations"
      %div#results{:class => "span-22"}
        / Facets
        = render :partial => "shared/facets"

        / Citations 
        = render :partial => "shared/citations"

  - elsif !@export.empty?
    %div{:class => "span-24"}
      %div{:class => "span-22 prepend-1"}
        %h2 Citations
        = @citations

  - else
    %div{:class => "span-22 prepend-1"}

      %h2 
        At the library, we
        %span{:style => "color:#990000;"} &hearts; 
        our researchers.
      
      %div{:class => "span-23"}
        
        / People
        = render :partial => "shared/people"

        / Citations
        %div{:class => "span-7", :style => "padding-left:0.75em; margin-bottom:2em;"}
          %h3.heading
            =link_to "Citations", citations_url(:view => "all")
          %ol#citations{:class => "span-7 citations", :style => "clear:both;"}
            - @docs.first(3).each do |citation, score|
              = render :partial => "shared/citation", :locals => {:citation => citation, :score => score}

      %div#facets{:class => "span-22"}
        
        / Groups
        %div{:class => "span-6"}
          %h3.heading=link_to "Groups", groups_url
          %ol#groups
            -active = Array.new
            -@facets[:group_id].each do |g|
              - group = object_by_facet_id(g.name)
              - if group.hide != true
                - active << [group, g.value]
            -active.first(15).each do |group, value|
              %li
                =link_to group.name, group_path(group)
                ="(#{value})"
            %li=link_to "More...", groups_path

        / Publications
        %div{:class => "span-7 prepend-1 append-1"}
          %h3.heading=link_to "Publications", publications_url
          %ol#publications
            -@facets[:publication_id].first(15).each do |p|
              - publication = object_by_facet_id(p.name)
              - next if publication.name == "Unknown"
              %li
                =link_to publication.name, publication_path(publication)
                ="(#{p.value})"
            %li=link_to "More...", publications_path

        / Publishers
        %div{:class => "span-6 last"}
          %h3.heading=link_to "Publishers", publishers_url
          %ol#publishers
            -@facets[:publisher_id].first(15).each do |p|
              - publisher = object_by_facet_id(p.name)
              - next if publisher.name == "Unknown"
              %li
                =link_to publisher.name, publisher_path(publisher)
                ="(#{p.value})"
            %li=link_to "More...", publishers_path